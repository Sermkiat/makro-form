<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (Marketlist)</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8 font-sans">
  <div class="max-w-md mx-auto bg-white p-6 rounded shadow">
    <h1 class="text-xl font-bold mb-4">üîç ‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤<br><small>(‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å Marketlist)</small></h1>
    <label class="block mb-2">
      üì¶ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠:
      <input id="itemInput" list="itemSuggestions" class="w-full p-2 border rounded" placeholder="‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠..." />
    </label>
    <datalist id="itemSuggestions"></datalist>
  </div>

  <script>
    // URL ‡∏Ç‡∏≠‡∏á Web App ‡∏ó‡∏µ‡πà Deploy ‡πÅ‡∏•‡πâ‡∏ß
    const scriptURL = 'https://script.google.com/macros/s/AKfycbydtdvHtF6-MYNcQ5CFYvwe2_ke6IHrnEgBRMN73eg_aiZmYMrbbOuedQieJbeUamgT/exec';

    // JSONP helper
    function jsonp(url, params, cbName) {
      return new Promise((resolve, reject) => {
        const script = document.createElement('script');
        window[cbName] = data => {
          resolve(data);
          delete window[cbName];
          document.body.removeChild(script);
        };
        const query = new URLSearchParams({ ...params, callback: cbName });
        script.src = `${url}?${query}`;
        script.onerror = () => {
          reject(new Error('JSONP load error'));
          delete window[cbName];
          document.body.removeChild(script);
        };
        document.body.appendChild(script);
      });
    }

    // ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡∏ä‡∏µ‡∏ï marketlist
    async function loadMarketItems() {
      try {
        const cbName = 'cbMarketTest' + Date.now();
        const response = await jsonp(scriptURL, { sheet: 'marketlist' }, cbName);
        console.log('Response from JSONP:', response);
        // ‡∏î‡∏∂‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞ array ‡∏Ç‡∏≠‡∏á marketlist
        const data = Array.isArray(response)
          ? response
          : (response.marketlist || []);
        console.log('Marketlist data:', data);

        const dl = document.getElementById('itemSuggestions');
        dl.innerHTML = ''; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Å‡πà‡∏≠‡∏ô
        data.forEach(row => {
          // ‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏´‡∏±‡∏ß‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÉ‡∏ô‡∏ä‡∏µ‡∏ï: 'MetrialName'
          const name = row['MetrialName'];
          if (name) {
            const opt = document.createElement('option');
            opt.value = name.trim();
            dl.appendChild(opt);
          }
        });
      } catch (err) {
        console.error('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• marketlist ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', err);
      }
    }

    // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏™‡∏£‡πá‡∏à -> ‡∏î‡∏∂‡∏á Marketlist
    document.addEventListener('DOMContentLoaded', loadMarketItems);
  </script>
</body>
</html>
