<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ó‡∏î‡∏•‡∏≠‡∏á</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-10 font-sans">
  <div class="max-w-xl mx-auto bg-white p-6 rounded shadow">
    <h1 class="text-xl font-bold mb-4">üîç ‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏à‡∏≤‡∏Å Marketlist)</h1>
    <label class="block mb-2">
      üì¶ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠:
      <input id="itemInput" list="itemSuggestions" class="w-full p-2 border rounded" placeholder="‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠..." />
    </label>
    <datalist id="itemSuggestions"></datalist>
  </div>

  <script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbydtdvHtF6-MYNcQ5CFYvwe2_ke6IHrnEgBRMN73eg_aiZmYMrbbOuedQieJbeUamgT/exec';

    function jsonp(url, params, cbName) {
      return new Promise((resolve, reject) => {
        const script = document.createElement('script');
        window[cbName] = data => {
          resolve(data);
          delete window[cbName];
          document.body.removeChild(script);
        };
        const query = new URLSearchParams({ ...params, callback: cbName });
        script.src = `${url}?${query}`;
        script.onerror = () => {
          reject(new Error('JSONP load error'));
          delete window[cbName];
          document.body.removeChild(script);
        };
        document.body.appendChild(script);
      });
    }

    async function loadMarketItems() {
      try {
        const cbName = 'cbMarketTest' + Date.now();
        const data = await jsonp(scriptURL, { sheet: 'marketlist' }, cbName);
        console.log('Marketlist:', data);

        const dl = document.getElementById('itemSuggestions');
        data.forEach(row => {
          if (row['Mettrial Name']) {
            const option = document.createElement('option');
            option.value = row['Mettrial Name'].trim();
            dl.appendChild(option);
          }
        });
      } catch (err) {
        console.error('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', err);
      }
    }

    document.addEventListener('DOMContentLoaded', loadMarketItems);
  </script>
</body>
</html>
