<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</title>
  <style>
    /* ==========================
       UI Styling ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô expense.html
    ========================== */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body { background: #5fa0ff; font-family: 'Noto Sans', sans-serif;
           display: flex; justify-content: center; align-items: flex-start;
           min-height: 100vh; padding: env(safe-area-inset-top) 16px env(safe-area-inset-bottom) 16px; }
    .container {
      background: #ffffff;
      border: 3px solid #c2e7ff;
      border-radius: 24px;
      width: 100%; max-width: 420px;
      padding: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    h1 {
      font-size: 20px;
      text-align: center;
      margin-bottom: 16px;
      padding-bottom: 10px;
      border-bottom: 4px solid #c2e7ff;
    }
    form {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .form-group {
      display: flex;
      flex-direction: column;
    }
    .form-group label {
      margin-bottom: 4px;
      font-weight: 500;
    }
    .form-group input {
      width: 100%; padding: 10px;
      font-size: 14px; height: 40px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background: #fff;
    }
    .btn-submit {
      margin-top: 12px;
      width: 100%;
      padding: 12px;
      font-size: 15px;
      color: #fff;
      background: #10b981;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      text-align: center;
    }
    .btn-submit:hover {
      background: #0f9b75;
    }
    .menu-links {
      display: flex;
      gap: 12px;
      margin-top: 24px;
    }
    .btn-nav {
      flex: 1;
      padding: 12px;
      font-size: 15px;
      font-weight: bold;
      text-align: center;
      color: #fff;
      border-radius: 8px;
      text-decoration: none;
    }
    .btn-blue { background: #3b82f6; }
    .btn-yellow { background: #ffdb4d; color: #111827; }
    .btn-purple { background: #8b3ced; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
  <div class="container">
    <h1>üíµ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</h1>
    <form id="incomeForm" novalidate>
      <div class="form-group">
        <label>üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
        <input type="date" name="date" required />
      </div>
      <div class="form-group">
        <label>üí∞ ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢</label>
        <input type="number" name="amount" step="0.01" min="0" required inputmode="decimal" />
      </div>
      <button type="submit" class="btn-submit">‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</button>
    </form>
    <nav class="menu-links">
      <a href="index.html" class="btn-nav btn-blue">üè† Home</a>
      <a href="expense.html" class="btn-nav btn-yellow">üßæ Expense</a>
      <a href="dashboard.html" class="btn-nav btn-purple">üìä Dashboard</a>
    </nav>
  </div>

  <script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbzez-fh075oK0A8-JxKz2sozwPLj2uF9jrpPLA_Mq0707SVhi2pp_FIa0NOfYe8EM8aYA/exec';

    function jsonp(url, params, cbName) {
      return new Promise((resolve, reject) => {
        window[cbName] = result => {
          resolve(result);
          delete window[cbName];
          script.remove();
        };
        const q = new URLSearchParams({ ...params, callback: cbName });
        const script = document.createElement('script');
        script.src = `${url}?${q}`;
        script.onerror = () => {
          reject(new Error('JSONP load error'));
          delete window[cbName];
          script.remove();
        };
        document.body.appendChild(script);
      });
    }

    document.getElementById('incomeForm').addEventListener('submit', async e => {
      e.preventDefault();
      const date = e.target.date.value;
      const amount = e.target.amount.value;

      Swal.fire({
        title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö...',
        allowOutsideClick: false,
        didOpen: () => Swal.showLoading()
      });

      try {
        const cbName = 'cb' + Date.now();
        const resp = await jsonp(scriptURL, { date, amount }, cbName);
        if (resp.status === 'success') {
          Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à','‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢','success')
            .then(() => location.href = 'index.html');
        } else {
          Swal.fire('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', resp.message || '‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à','error');
        }
      } catch {
        Swal.fire('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î','‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ','error');
      }
    });
  </script>
</body>
</html>
