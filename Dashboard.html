<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://unpkg.com/tabletop@1.6.4/src/tabletop.js"></script>
</head>
<body class="bg-gray-100 font-sans p-4">
  <div class="max-w-6xl mx-auto">
    <h1 class="text-2xl font-bold mb-6">üìä ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h1>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
      <div class="bg-white p-4 rounded shadow">
        <h2 class="text-lg font-semibold">üí∞ ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
        <p id="totalSpending" class="text-2xl text-green-600 mt-2">0.00 ‡∏ö‡∏≤‡∏ó</p>
      </div>
      <div class="bg-white p-4 rounded shadow">
        <h2 class="text-lg font-semibold">üìÖ ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</h2>
        <ul id="dailySpending" class="text-sm mt-2"></ul>
      </div>
      <div class="bg-white p-4 rounded shadow">
        <h2 class="text-lg font-semibold">üóìÔ∏è ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h2>
        <ul id="monthlySpending" class="text-sm mt-2"></ul>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
      <div class="bg-white p-4 rounded shadow">
        <h2 class="text-lg font-semibold">üìä ‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ó‡πà‡∏á: ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</h2>
        <canvas id="barChart"></canvas>
      </div>
      <div class="bg-white p-4 rounded shadow">
        <h2 class="text-lg font-semibold">üßÅ ‡∏Å‡∏£‡∏≤‡∏ü‡∏ß‡∏á‡∏Å‡∏•‡∏°: ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠</h2>
        <canvas id="pieChart"></canvas>
      </div>
    </div>

    <div class="bg-white p-4 rounded shadow">
      <h2 class="text-lg font-semibold">üèÜ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠‡∏ö‡πà‡∏≠‡∏¢ 5 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</h2>
      <ul id="topItems" class="list-decimal ml-5 mt-2 text-sm"></ul>
    </div>
  </div>

  <script>
    const sheetURL = 'https://docs.google.com/spreadsheets/d/1bniIL-y285kEHvF_bzRRBOUYGrwcjwEaIrxWGIwh71s/edit?usp=sharing';

    window.addEventListener('DOMContentLoaded', () => {
      Tabletop.init({
        key: sheetURL,
        simpleSheet: true,
        callback: function(data) {
          let total = 0;
          const dailyMap = {};
          const monthlyMap = {};
          const itemMap = {};

          data.forEach(row => {
            const date = row["‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠"] || row.date;
            const item = row["‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£"] || row.item;
            const price = parseFloat(row["‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°"] || row.totalPrice || 0);

            if (!date || !item || isNaN(price)) return;

            total += price;
            dailyMap[date] = (dailyMap[date] || 0) + price;

            const month = date.slice(0, 7);
            monthlyMap[month] = (monthlyMap[month] || 0) + price;

            itemMap[item] = (itemMap[item] || 0) + 1;
          });

          document.getElementById("totalSpending").textContent = total.toFixed(2) + " ‡∏ö‡∏≤‡∏ó";

          // ‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô
          const dailyList = document.getElementById("dailySpending");
          Object.entries(dailyMap).forEach(([date, value]) => {
            const li = document.createElement("li");
            li.textContent = `${date}: ${value.toFixed(2)} ‡∏ö‡∏≤‡∏ó`;
            dailyList.appendChild(li);
          });

          // ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
          const monthlyList = document.getElementById("monthlySpending");
          Object.entries(monthlyMap).forEach(([month, value]) => {
            const li = document.createElement("li");
            li.textContent = `${month}: ${value.toFixed(2)} ‡∏ö‡∏≤‡∏ó`;
            monthlyList.appendChild(li);
          });

          // ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏ö‡πà‡∏≠‡∏¢
          const topItems = Object.entries(itemMap).sort((a, b) => b[1] - a[1]).slice(0, 5);
          const topList = document.getElementById("topItems");
          topItems.forEach(([item, count]) => {
            const li = document.createElement("li");
            li.textContent = `${item} (${count} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á)`;
            topList.appendChild(li);
          });

          // ‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ó‡πà‡∏á
          new Chart(document.getElementById("barChart"), {
            type: "bar",
            data: {
              labels: Object.keys(dailyMap),
              datasets: [{
                label: "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô",
                data: Object.values(dailyMap)
              }]
            },
          });

          // ‡∏Å‡∏£‡∏≤‡∏ü‡∏ß‡∏á‡∏Å‡∏•‡∏°
          new Chart(document.getElementById("pieChart"), {
            type: "pie",
            data: {
              labels: Object.keys(itemMap),
              datasets: [{
                label: "‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠",
                data: Object.values(itemMap)
              }]
            },
          });
        }
      });
    });
  </script>
</body>
</html>
