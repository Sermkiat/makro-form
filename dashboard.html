<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>PangPun Dashboard</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    h1, h2 { margin-top: 1.5em; }
    #totals p { font-size: 1.2em; }
    canvas { max-width: 600px; margin: 20px 0; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  </style>
</head>
<body>
  <h1>üìä Dashboard ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö-‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h1>

  <!-- ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏ß‡∏° -->
  <div id="totals">
    <p>‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <strong><span id="total-expenses">0</span> ‡∏ø</strong></p>
  </div>

  <!-- ‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ó‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô -->
  <h2>‡∏Å‡∏£‡∏≤‡∏ü‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</h2>
  <canvas id="dailyChart"></canvas>

  <!-- ‡∏Å‡∏£‡∏≤‡∏ü‡∏ß‡∏á‡∏Å‡∏•‡∏°‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà -->
  <h2>‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
  <canvas id="categoryChart"></canvas>

  <!-- ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô -->
  <h2>‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</h2>
  <ul id="daily-summary"></ul>

  <h2>‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h2>
  <ul id="monthly-summary"></ul>

  <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á Top 5 ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ã‡∏∑‡πâ‡∏≠‡∏ö‡πà‡∏≠‡∏¢ -->
  <h2>Top 5 ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ã‡∏∑‡πâ‡∏≠‡∏ö‡πà‡∏≠‡∏¢</h2>
  <table id="top-items">
    <thead>
      <tr><th>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á</th></tr>
    </thead>
    <tbody></tbody>
  </table>
  
  <!-- ‡πÇ‡∏´‡∏•‡∏î Chart.js ‡∏à‡∏≤‡∏Å CDN  [oai_citation:0‚Ä°chartjs.org](https://www.chartjs.org/docs/latest/getting-started/?utm_source=chatgpt.com) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
    // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô URL ‡∏Ç‡∏≠‡∏á Web App ‡∏ó‡∏µ‡πà‡πÇ‡∏õ‡πâ deploy ‡πÑ‡∏ß‡πâ (MakroLog)
    const endpoint = 'https://script.google.com/macros/s/XXX/exec?sheet=MakroLog';

    fetch(endpoint)
      .then(res => res.json())   // ‡∏£‡∏±‡∏ö JSON ‡∏à‡∏≤‡∏Å GAS Web App  [oai_citation:1‚Ä°Google for Developers](https://developers.google.com/apps-script/guides/web?utm_source=chatgpt.com)
      .then(data => {
        // data ‡∏™‡∏°‡∏°‡∏ï‡∏¥‡πÄ‡∏õ‡πá‡∏ô array ‡∏Ç‡∏≠‡∏á object ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏ô‡∏ä‡∏µ‡∏ó
        // { purchaseDate, itemName, category, quantity, unitPrice, totalPrice }

        // 1) ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏ß‡∏°
        const total = data.reduce((sum, r) => sum + parseFloat(r.totalPrice), 0);
        document.getElementById('total-expenses').textContent = total.toLocaleString();

        // 2) ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô
        const dailyMap = {};
        data.forEach(r => {
          const d = r.purchaseDate;
          dailyMap[d] = (dailyMap[d]||0) + parseFloat(r.totalPrice);
        });
        const dailyLabels = Object.keys(dailyMap).sort();
        const dailyValues = dailyLabels.map(d => dailyMap[d]);

        // 3) ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
        const monthlyMap = {};
        dailyLabels.forEach(d => {
          const m = d.slice(0,7); // 'YYYY-MM'
          monthlyMap[m] = (monthlyMap[m]||0) + dailyMap[d];
        });

        // 4) ‡∏™‡∏£‡∏∏‡∏õ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà (Pie Chart)
        const categoryMap = {};
        data.forEach(r => {
          categoryMap[r.category] = (categoryMap[r.category]||0) + parseFloat(r.totalPrice);
        });
        const categoryLabels = Object.keys(categoryMap);
        const categoryValues = categoryLabels.map(c => categoryMap[c]);

        // 5) ‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ Top 5 ‡∏ã‡∏∑‡πâ‡∏≠‡∏ö‡πà‡∏≠‡∏¢
        const freq = {};
        data.forEach(r => {
          freq[r.itemName] = (freq[r.itemName]||0) + 1;
        });
        const top5 = Object.entries(freq)
          .sort((a,b) => b[1]-a[1])
          .slice(0,5);

        // ‚Äî‚Äî ‡∏ß‡∏≤‡∏î‡∏Å‡∏£‡∏≤‡∏ü ‚Äî‚Äî 
        // Bar Chart ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô
        new Chart(document.getElementById('dailyChart'), {
          type: 'bar',
          data: {
            labels: dailyLabels,
            datasets: [{ label: '‡∏ø', data: dailyValues }]
          }
        });

        // Pie Chart ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà
        new Chart(document.getElementById('categoryChart'), {
          type: 'pie',
          data: {
            labels: categoryLabels,
            datasets: [{ data: categoryValues }]
          }
        });

        // ‚Äî‚Äî ‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏õ‡πá‡∏ô text/table ‚Äî‚Äî 
        const dailyList = document.getElementById('daily-summary');
        dailyLabels.forEach(d => {
          const li = document.createElement('li');
          li.textContent = `${d}: ${dailyMap[d].toLocaleString()} ‡∏ø`;
          dailyList.appendChild(li);
        });
        const monthlyList = document.getElementById('monthly-summary');
        Object.keys(monthlyMap).sort().forEach(m => {
          const li = document.createElement('li');
          li.textContent = `${m}: ${monthlyMap[m].toLocaleString()} ‡∏ø`;
          monthlyList.appendChild(li);
        });
        const tbody = document.querySelector('#top-items tbody');
        top5.forEach(([name,count]) => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${name}</td><td>${count}</td>`;
          tbody.appendChild(tr);
        });
      })
      .catch(err => console.error(err));
  </script>
</body>
</html>
