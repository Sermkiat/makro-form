<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Auto Fill Suggestion Form</title>
  <style>
    input, button { margin: 5px; padding: 8px; width: 200px; }
  </style>
</head>
<body>
  <h3>üìã ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
  
  <label>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:</label><br>
  <input type="text" id="name" list="namelist"><br>
  <datalist id="namelist"></datalist>

  <label>‡∏´‡∏ô‡πà‡∏ß‡∏¢:</label><br>
  <input type="text" id="unit" readonly><br>

  <label>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà:</label><br>
  <input type="text" id="group" readonly><br>

  <button onclick="submitData()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>

  <div id="preview"></div>

  <script>
    const apiUrl = 'https://script.google.com/macros/s/AKfycbzez-fh075oK0A8-JxKz2sozwPLj2uF9jrpPLA_Mq0707SVhi2pp_FIa0NOfYe8EM8aYA/exec';

    let dataList = [];

    // 1. ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å marketlist
    fetch(apiUrl + '?sheet=marketlist')
      .then(res => res.json())
      .then(data => {
        dataList = data;
        const datalist = document.getElementById('namelist');
        data.forEach(item => {
          const option = document.createElement('option');
          option.value = item.name;
          datalist.appendChild(option);
        });
      });

    // 2. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå/‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‚Üí ‡πÄ‡∏ï‡∏¥‡∏° unit/group
    document.getElementById('name').addEventListener('input', function () {
      const inputName = this.value.trim();
      const found = dataList.find(item => item.name === inputName);
      if (found) {
        document.getElementById('unit').value = found.unit || '';
        document.getElementById('group').value = found.group || '';
      }
    });

    // 3. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏ó‡∏µ‡πà datalog
    function submitData() {
      const name = document.getElementById('name').value.trim();
      const unit = document.getElementById('unit').value.trim();
      const group = document.getElementById('group').value.trim();

      // Preview ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á
      document.getElementById('preview').innerHTML = `
        ‚úÖ <b>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:</b><br>
        üõí ‡∏ä‡∏∑‡πà‡∏≠: ${name}<br>
        üì¶ ‡∏´‡∏ô‡πà‡∏ß‡∏¢: ${unit}<br>
        üóÇÔ∏è ‡∏´‡∏°‡∏ß‡∏î: ${group}<br>
      `;

      const payload = {
        sheet: 'datalog',
        name, unit, group
      };

      fetch(apiUrl, {
        method: 'POST',
        body: JSON.stringify(payload),
        headers: { 'Content-Type': 'application/json' }
      })
      .then(res => res.text())
      .then(msg => alert('üì• ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + msg))
      .catch(err => alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + err));
    }
  </script>
</body>
</html>
