<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="bg-gray-100 min-h-screen p-4">
  <div class="max-w-4xl mx-auto bg-white p-6 rounded shadow">
    <h1 class="text-2xl font-bold mb-4">üì¶ ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h1>

    <div class="mb-4">
      <label class="block mb-1 font-medium">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠:</label>
      <input type="date" id="purchaseDate" class="w-full border px-3 py-2 rounded" required>
    </div>

    <div class="mb-4">
      <label class="block mb-1 font-medium">üè™ ‡πÅ‡∏´‡∏•‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠:</label>
      <select id="purchaseSource" class="w-full border px-3 py-2 rounded">
        <option value="Makro">Makro</option>
        <option value="Lotus">Lotus</option>
        <option value="Tops">Tops</option>
        <option value="Homepro">Homepro</option>
        <option value="‡∏ä‡∏ß‡∏ô‡∏ä‡∏°‡πÄ‡∏ö‡πÄ‡∏Å‡∏≠‡∏£‡∏µ‡πà">‡∏ä‡∏ß‡∏ô‡∏ä‡∏°‡πÄ‡∏ö‡πÄ‡∏Å‡∏≠‡∏£‡∏µ‡πà</option>
        <option value="‡∏û‡∏µ‡πà‡πÄ‡∏à‡πã‡∏á">‡∏û‡∏µ‡πà‡πÄ‡∏à‡πã‡∏á</option>
        <option value="‡∏ï‡∏•‡∏≤‡∏î‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏ô‡∏≤‡∏ô‡∏≤‡∏ä‡∏≤‡∏ï‡∏¥">‡∏ï‡∏•‡∏≤‡∏î‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏ô‡∏≤‡∏ô‡∏≤‡∏ä‡∏≤‡∏ï‡∏¥</option>
      </select>
    </div>

    <table class="w-full mb-4" id="expenseTable">
      <thead>
        <tr class="bg-gray-200">
          <th class="p-2">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠</th>
          <th class="p-2">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
          <th class="p-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
          <th class="p-2">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
          <th class="p-2">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°</th>
          <th class="p-2">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
          <th class="p-2">‡∏•‡∏ö</th>
        </tr>
      </thead>
      <tbody id="expenseBody"></tbody>
    </table>

    <button onclick="addRow()" class="bg-blue-500 text-white px-4 py-2 rounded mb-4">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
    <br>
    <button onclick="submitForm()" class="bg-green-600 text-white px-6 py-3 rounded font-bold">üì§ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
  </div>

  <script>
    let scriptURL = 'https://script.google.com/macros/s/AKfycbwHOvbfZwUDupnVZeHoW_CTFNYs9AYGk7CCzRt8XVHDTXn5t3nMJ4PZMDqBgDFg-oZS/exec';

    function addRow() {
      const tbody = document.getElementById('expenseBody');
      const row = document.createElement('tr');
      row.innerHTML = `
        <td><input type="text" class="w-full border px-2 py-1" required></td>
        <td>
          <select class="w-full border px-2 py-1">
            <option value="‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö">‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</option>
            <option value="‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≤‡∏ß">‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≤‡∏ß</option>
            <option value="‡∏Ç‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏ö‡πâ‡∏≤‡∏ô">‡∏Ç‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏ö‡πâ‡∏≤‡∏ô</option>
            <option value="‡∏Ç‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô">‡∏Ç‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô</option>
          </select>
        </td>
        <td><input type="number" min="0" class="w-full border px-2 py-1" onchange="calcTotal(this)" required></td>
        <td><input type="number" min="0" class="w-full border px-2 py-1" onchange="calcTotal(this)" required></td>
        <td><input type="text" class="w-full border px-2 py-1 bg-gray-100" readonly></td>
        <td><input type="text" class="w-full border px-2 py-1"></td>
        <td><button onclick="this.closest('tr').remove()" class="text-red-600">‚ùå</button></td>
      `;
      tbody.appendChild(row);
    }

    function calcTotal(el) {
      const row = el.closest('tr');
      const qty = row.children[2].children[0].value;
      const price = row.children[3].children[0].value;
      const total = (parseFloat(qty || 0) * parseFloat(price || 0)).toFixed(2);
      row.children[4].children[0].value = total;
    }

    async function submitForm() {
      const date = document.getElementById('purchaseDate').value;
      const source = document.getElementById('purchaseSource').value;
      const rows = document.querySelectorAll('#expenseBody tr');
      if (!date || rows.length === 0) return Swal.fire('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£');

      const payload = [];
      rows.forEach(row => {
        const cells = row.querySelectorAll('td');
        payload.push({
          date: date,
          source: source,
          item: cells[0].children[0].value,
          category: cells[1].children[0].value,
          qty: cells[2].children[0].value,
          unitPrice: cells[3].children[0].value,
          totalPrice: cells[4].children[0].value,
          note: cells[5].children[0].value
        });
      });

      try {
        const res = await fetch(scriptURL, {
          method: 'POST',
          body: JSON.stringify(payload),
          headers: {
            'Content-Type': 'application/json'
          }
        });
        if (!res.ok) throw new Error('‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
        Swal.fire('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', '', 'success');
        document.getElementById('expenseBody').innerHTML = '';
      } catch (err) {
        Swal.fire('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', err.message, 'error');
      }
    }

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ 1 ‡πÅ‡∏ñ‡∏ß
    addRow();
  </script>
</body>
</html>
